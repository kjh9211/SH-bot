name: Discord Notification on Push

on:
  push:
    branches:
      - main # ë³€ê²½ ì‚¬í•­ì„ ê°ì§€í•  ë¸Œëœì¹˜ (ì˜ˆ: master ë˜ëŠ” main)
    paths:
      - 'Team of service.md' # ì•½ê´€ íŒŒì¼ ê²½ë¡œë¥¼ ì—¬ê¸°ì— ì •í™•íˆ ì…ë ¥ (ì˜ˆ: 'docs/TOS.md')

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }} # GitHub Secretsì— ì›¹í›… URL ì €ì¥
        run: |
          # GitHubì˜ ê¸°ë³¸ í˜ì´ë¡œë“œë¥¼ Discord ì›¹í›… í˜•ì‹ì— ë§ì¶° ë³€í™˜í•˜ì—¬ ì „ì†¡
          # JQë¥¼ ì‚¬ìš©í•˜ì—¬ JSON íŒŒì‹± ë° ìƒì„±
          # ë©”ì‹œì§€ ë‚´ìš©ì„ ì›í•˜ëŠ”ëŒ€ë¡œ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥
          COMMIT_MESSAGE=$(jq -r '.head_commit.message' "$GITHUB_EVENT_PATH")
          COMMIT_URL=$(jq -r '.head_commit.url' "$GITHUB_EVENT_PATH")
          REPOSITORY_NAME=$(jq -r '.repository.full_name' "$GITHUB_EVENT_PATH")
          PUSHER_NAME=$(jq -r '.pusher.name' "$GITHUB_EVENT_PATH")

          if [ "$COMMIT_MESSAGE" = "null" ]; then
            COMMIT_MESSAGE="ìƒˆë¡œìš´ ë³€ê²½ì‚¬í•­ì´ í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤."
          fi

          # Discord ì›¹í›… í˜ì´ë¡œë“œ êµ¬ì„±
          json_payload=$(jq -n \
            --arg content "ğŸ”” **${REPOSITORY_NAME}** ì•½ê´€ ë¬¸ì„œì— ë³€ê²½ì‚¬í•­ì´ í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤." \
            --arg title "$COMMIT_MESSAGE" \
            --arg url "$COMMIT_URL" \
            --arg description "í‘¸ì‹œí•œ ì‚¬ëŒ: **${PUSHER_NAME}**" \
            --argjson color 5814783 \
            '{
              content: $content,
              embeds: [
                {
                  title: $title,
                  url: $url,
                  description: $description,
                  color: $color
                }
              ]
            }'
          )

          # Discord ì›¹í›…ìœ¼ë¡œ ì „ì†¡
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$json_payload" \
               "$DISCORD_WEBHOOK"
